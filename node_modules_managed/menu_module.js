var fs = require('fs');
var config = require('../data/config');

var _item;


var obj = {
    menuItems:getMenuItems(-1),
    starters:getMenuItems(0),
    maincourse:getMenuItems(1),
    desserts:getMenuItems(2),
    drinks:getMenuItems(3),
    setMenuItem:function(item){
        _item = item;
    },
    addNewItem:function(){
        var codes = getCodesJSON();
        var foods = getRawJSON("food.json");
        foods[_item.foodCategory].push(_item); 
        appendFoodJSON();
        return codes.ok;
    }
}
 



function appendFoodJSON(dataObj)
{
   fs.writeFileSync(config.dataFolderPath + '/food.json',JSON.stringify(dataObj));
}

function getRawJSON(fileName)
{
    var stringIn = fs.readFileSync(config.dataFolderPath + '/'+fileName,"utf8").trim();
    var JSONData = JSON.parse(stringIn);
    return JSONData;
}



function getMenuItems(itemType)
{
    var menuJSON = getRawJSON('food.json');
    if(itemType == -1)
    {
        menuJSON = JSON.stringify(menuJSON);
    }
    else
    {
        var elements = menuJSON[itemType];
        for(var i=0;i<elements.length;i++)
        {
            elements[i].imagePath = config.menuItemImagesPath +"/"+elements[i].imagePath;
        }
        menuJSON = JSON.stringify(elements);
    }
    return menuJSON;
}

function getCodesJSON()
{
    var stringIn = fs.readFileSync(config.dataFolderPath + '/codes.json',"utf8").trim();
    return JSON.parse(stringIn);
}

module.exports = obj;